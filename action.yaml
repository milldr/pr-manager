name: 'Pull Request Manager'
description: 'GitHub Pull Request Manager'
author: 'Daniel Miller'
branding:
  icon: 'arrow-right-circle'
  color: 'red'

inputs:
  token:
    description: "A GitHub token with permission to comment on PRs"
    required: true

runs:
  using: 'composite'
  steps:
    - name: Checkout this action
      uses: actions/checkout@v4

    - uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install octokit
      shell: bash
      run: |
        npm install @octokit/action

    - name: Fetch all open PR comments 
      id: fetch
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.token }}
      run: node src/fetch-comments.js

    - name: Checking for dependent PRs
      id: dependencies
      shell: bash
      run: |
        echo "${steps.fetch.outputs.comment-id}"
        echo "blocked-by=\"pr-1\"" > $GITHUB_OUTPUT

    - name: Post or update comment
      uses: peter-evans/create-or-update-comment@v4
      with:
        token: ${{ inputs.token }}
        issue-number: ${{ github.event.pull_request.number }}
        body: |
          Dependent Issues
          - ${{ steps.dependencies.outputs.blocked-by }}

          References
          - Created by [milldr/pr-manager][1]

          [1]: https://github.com/milldr/pr-manager

          <!-- DO NOT REMOVE - [managed by milldr/pr-manager] -->
